---
title: 'Generalized Linear Models'
subtitle: 'For Over-Dispersed Data'
format: 
  baylor_theme-revealjs:
    author: 'Nathen Byford'
    footer: 'Nathen Byford'
    controls: auto
    embed-resources: true
---

```{r}
#| include: false

library(tidyverse); theme_set(theme_bw())
library(flextable)
```

## Basics of Generalized Linear Models (GLMs)

- GLMs are a flexible generalization of ordinary linear regression that allows for response variables that have error distribution models other than a normal distribution.
- **Components of GLMs**:
  - **Random Component**: Specifies the distribution of the response variable (e.g., Normal, Binomial, Poisson).
  - **Systematic Component**: A linear predictor, a combination of explanatory variables (predictors).
  - **Link Function**: Connects the mean of the response variable to the linear predictor (e.g., identity, log, logit).

## Common link functions and GLMS

- **Identity Link**: Used for normally distributed data (linear regression).
- **Logit Link**: Used for binary outcome data (logistic regression).
- **Log Link**: Used for count data (Poisson regression).


## Over-Dispersed Data
- Over-dispersion in general refers to having variance greater than that assumed for the theoretical data model.  
- Over-dispersion can also refer to having a variance that is greater than the mean
    - Similarly equi-dispersion would refer to having variance equal to the mean.

::: {.callout-note icon=false}
### Poisson regression

Poisson regression is the most popular method for modeling count data. The Poisson distribution brings with it the assumption of equi-dispersion that is often unsatisfied.
:::

## Common applicataions

::::{.columns}
:::{.column width="50%"}
- Count data in Biology
- Epidemiology
- Finance
- Insurance claims
- Environmental studies
- etc.
:::

:::{.column width="50%"}
![](daily_stock_trades.png){width="80%" fig-align="center"}

![](woodlark.png){width="50%" fig-align="center"}
:::

::::

:::{.def}
:::{.subsubtext}
Almost any real world count data is subject to the possibility of over-dispersion.
:::
:::

## Causes

::::{.columns}
:::{.column width="50%"}
- Increased variability of counts
- Event clustering
- Increased number of 0
- Interaction effects
- Measurement error
- Environmental effects
:::

:::{.column width="50%"}
![](topographic.png)
:::
::::

## Candidate Distributions

1. Negative-Binomial
2. Generalized Poisson
3. Double Poisson
4. Conway-Maxwell-Poisson (CMP)

- Zero inflated disitributions
    - ZIP
    - ZINB
    - ZIDP/ZIGP
    
    
::::{.columns}
:::{.column width="50%"}

```{r}
#| fig-width: 5
#| fig-height: 2.5

set.seed(7)

nb_data <- rnbinom(1000, 100, .3)

vals <- seq(min(nb_data), max(nb_data))
pois_est <- tibble(x = vals, y = dpois(x, mean(nb_data)))

tibble(x = nb_data) |> 
  ggplot(aes(x)) + 
  geom_histogram(aes(y = after_stat(density))) +
  geom_line(data = pois_est, aes(x = x, y = y)) +
  geom_density(color = "blue") +
  labs(
    title = "Negative-Binomial data with fitted Poisson model"
  )
```
:::

:::{.column width="50%"}

```{r}
#| fig-width: 5
#| fig-height: 2.5


pois_data <- rpois(1000, 6)
zip_data <- c(pois_data, rep(0, 1000))

N <- max(pois_data) + 1

tibble(x = zip_data) |> 
  ggplot(aes(x)) +
  geom_histogram(aes(y = after_stat(density))) +
  geom_density(color = "blue") +
  geom_function(fun = dpois, args = list(lambda = mean(zip_data)), n = N) +
  labs(
    title = "Zero inflated Poisson data with fitted Poisson model"
  )
```
:::
::::

## Negative-Binomial

- Parameters: mean: $\mu$, dispersion: $k$[^1]
- Variance: $\mu + \mu^2/k$
    - Function of mean and dispersion parameter
    - Clearly captures over-dispersion.

[^1]: The classic negative-binomial is parameterized as number of success and probability of success, $r$ and $p$.


## Generalized Poisson

- Parameters: $\lambda$, $\theta$
- Mean: $\lambda / (1- \theta)$
- Variance: $\lambda / (1- \theta)^3$

$$
f(Y = y) = \frac{\lambda(\lambda + \theta y)^{y-1} e^{-(\lambda + \theta y)}}{y!}, \quad \lambda > 0,\space \theta \in \mathbb{R}
$$

- Designed to extend to overdispersed and underdispersed count data

:::{.smalltext}
| $\theta = 0$ | $\theta > 0$ | $\theta < 0$ |
|:-------------|:-------------|:-------------|
| reduces to Poisson | Models overdispersion | Models underdispersion |
:::

## Double Poisson

- Parameters: $\mu$, $\theta$
- variance: $\mu / \theta$
- Extension of the double exponential family (Efron 1986) defined by pmf
$$
f(Y = y) = (\theta^{1/2}e^{-\theta\mu}) \left(\frac{e^{y}y^y}{y!}\right) \left(\frac{e \mu}{y}\right)^{\theta y}
$$


## Conway-Maxwell Poisson (CMP)

- Parameters: $\lambda$, $\nu$
- Weighted Poison distribution with pmf:
$$
f(Y = y) = \frac{\lambda^y}{(y!)^\nu Z(\lambda, \nu)}, \quad Z(\lambda, \nu) = \sum_{y=0}^\infty \frac{\lambda^y}{(y!)^\nu}
$$
- Includes spacial cases of Poison$(\lambda)$ when $\nu = 1$, geometric$(\lambda)$

## Model comparisons

- 2008 Bayesian paper compares the Generalized Poisson distribution,

```{r}
tribble(
  ~Model, ~Poisson, ~NB, ~GP,
  "DIC", 1291.8, 1273.9, 1265.6
) |> 
  flextable()
```

- Bayesian paper compared Poisson, Negative Binomial, and CMP for longitudinal counts using DIC to compare. (Alam et al.)

```{r}
tribble(
  ~Model, ~Poisson, ~NB, ~CMP,
  "DIC", 1362.39, 1350.67, 1348.87
) |>
  flextable()
```

- Another Bayesian paper compared using AIC and shows the following results (Sellers and Shmueli)

```{r}
tribble(
  ~Model, ~CMP, ~Poisson, ~"Neg-Bin",
  "AIC", 5073, 5589, 5077
) |>
  flextable()
```

## Results

- It has been found and shown that modeling over-dispersed data with impropper distributions leads to biased results.
- To prevent biased results from over dispersed data, using models such as the CMP, GP, or DP model can prove benneficial
- Overall the CMP is found to have the most flexability modeling of over- and under-dispersion due to the GP model truncating for some dispersion parameters


## References

